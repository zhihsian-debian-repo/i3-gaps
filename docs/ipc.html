<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<title>IPC interface (interprocess communication)</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>IPC interface (interprocess communication)</h1>
<span id="author">Michael Stapelberg</span><br />
<span id="email"><code>&lt;<a href="mailto:michael@i3wm.org">michael@i3wm.org</a>&gt;</code></span><br />
<span id="revdate">September 2017</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>This document describes how to interface with i3 from a separate process. This
is useful for example to remote-control i3 (to write test cases for example) or
to get various information like the current workspaces to implement an external
workspace bar.</p></div>
<div class="paragraph"><p>The method of choice for IPC in our case is a unix socket because it has very
little overhead on both sides and is usually available without headaches in
most languages. In the default configuration file, the ipc-socket gets created
in <code>/tmp/i3-%u.XXXXXX/ipc-socket.%p</code> where <code>%u</code> is your UNIX username, <code>%p</code> is
the PID of i3 and XXXXXX is a string of random characters from the portable
filename character set (see mkdtemp(3)). You can get the socketpath from i3 by
calling <code>i3 --get-socketpath</code>.</p></div>
<div class="paragraph"><p>All i3 utilities, like <code>i3-msg</code> and <code>i3-input</code> will read the <code>I3_SOCKET_PATH</code>
X11 property, stored on the X11 root window.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="title">Use an existing library!</div>There are existing libraries for many languages. You can have a look at
<a href="#libraries">[libraries]</a> or search the web if your language of choice is not mentioned.
Usually, it is not necessary to implement low-level communication with i3
directly.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_establishing_a_connection">1. Establishing a connection</h2>
<div class="sectionbody">
<div class="paragraph"><p>To establish a connection, simply open the IPC socket. The following code
snippet illustrates this in Perl:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>use IO::Socket::UNIX;
chomp(my $path = qx(i3 --get-socketpath));
my $sock = IO::Socket::UNIX-&gt;new(Peer =&gt; $path);</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_messages_to_i3">2. Sending messages to i3</h2>
<div class="sectionbody">
<div class="paragraph"><p>To send a message to i3, you have to format in the binary message format which
i3 expects. This format specifies a magic string in the beginning to ensure
the integrity of messages (to prevent follow-up errors). Following the magic
string comes the length of the payload of the message as 32-bit integer, and
the type of the message as 32-bit integer (the integers are not converted, so
they are in native byte order).</p></div>
<div class="paragraph"><p>The magic string currently is "i3-ipc" and will only be changed when a change
in the IPC API is done which breaks compatibility (we hope that we don’t need
to do that).</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. Currently implemented message types</caption>
<col width="10%" />
<col width="20%" />
<col width="20%" />
<col width="50%" />
<thead>
<tr>
<th align="center" valign="top"> Type (numeric) </th>
<th align="center" valign="top"> Type (name) </th>
<th align="center" valign="top"> Reply type </th>
<th align="center" valign="top"> Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"><code>RUN_COMMAND</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_command_reply">COMMAND</a></p></td>
<td align="center" valign="top"><p class="table">Run the payload as an i3 command (like the commands you can bind to keys).</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"><code>GET_WORKSPACES</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_workspaces_reply">WORKSPACES</a></p></td>
<td align="center" valign="top"><p class="table">Get the list of current workspaces.</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">2</p></td>
<td align="center" valign="top"><p class="table"><code>SUBSCRIBE</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_subscribe_reply">SUBSCRIBE</a></p></td>
<td align="center" valign="top"><p class="table">Subscribe this IPC connection to the event types specified in the message payload. See <a href="#events">[events]</a>.</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">3</p></td>
<td align="center" valign="top"><p class="table"><code>GET_OUTPUTS</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_outputs_reply">OUTPUTS</a></p></td>
<td align="center" valign="top"><p class="table">Get the list of current outputs.</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">4</p></td>
<td align="center" valign="top"><p class="table"><code>GET_TREE</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_tree_reply">TREE</a></p></td>
<td align="center" valign="top"><p class="table">Get the i3 layout tree.</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">5</p></td>
<td align="center" valign="top"><p class="table"><code>GET_MARKS</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_marks_reply">MARKS</a></p></td>
<td align="center" valign="top"><p class="table">Gets the names of all currently set marks.</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">6</p></td>
<td align="center" valign="top"><p class="table"><code>GET_BAR_CONFIG</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_bar_config_reply">BAR_CONFIG</a></p></td>
<td align="center" valign="top"><p class="table">Gets the specified bar configuration or the names of all bar configurations if payload is empty.</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">7</p></td>
<td align="center" valign="top"><p class="table"><code>GET_VERSION</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_version_reply">VERSION</a></p></td>
<td align="center" valign="top"><p class="table">Gets the i3 version.</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">8</p></td>
<td align="center" valign="top"><p class="table"><code>GET_BINDING_MODES</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_binding_modes_reply">BINDING_MODES</a></p></td>
<td align="center" valign="top"><p class="table">Gets the names of all currently configured binding modes.</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">9</p></td>
<td align="center" valign="top"><p class="table"><code>GET_CONFIG</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_config_reply">CONFIG</a></p></td>
<td align="center" valign="top"><p class="table">Returns the last loaded i3 config.</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">10</p></td>
<td align="center" valign="top"><p class="table"><code>SEND_TICK</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_tick_reply">TICK</a></p></td>
<td align="center" valign="top"><p class="table">Sends a tick event with the specified payload.</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">11</p></td>
<td align="center" valign="top"><p class="table"><code>SYNC</code></p></td>
<td align="center" valign="top"><p class="table"><a href="#_sync_reply">SYNC</a></p></td>
<td align="center" valign="top"><p class="table">Sends an i3 sync event with the specified random value to the specified window.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>So, a typical message could look like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>"i3-ipc" &lt;message length&gt; &lt;message type&gt; &lt;payload&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Or, as a hexdump:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>00000000  69 33 2d 69 70 63 04 00  00 00 00 00 00 00 65 78  |i3-ipc........ex|
00000010  69 74                                             |it|</code></pre>
</div></div>
<div class="paragraph"><p>To generate and send such a message, you could use the following code in Perl:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>sub format_ipc_command {
    my ($msg) = @_;
    my $len;
    # Get the real byte count (vs. amount of characters)
    { use bytes; $len = length($msg); }
    return "i3-ipc" . pack("LL", $len, 0) . $msg;
}

$sock-&gt;write(format_ipc_command("exit"));</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_receiving_replies_from_i3">3. Receiving replies from i3</h2>
<div class="sectionbody">
<div class="paragraph"><p>Replies from i3 usually consist of a simple string (the length of the string
is the message_length, so you can consider them length-prefixed) which in turn
contain the JSON serialization of a data structure. For example, the
GET_WORKSPACES message returns an array of workspaces (each workspace is a map
with certain attributes).</p></div>
<div class="sect2">
<h3 id="_reply_format">3.1. Reply format</h3>
<div class="paragraph"><p>The reply format is identical to the normal message format. There also is
the magic string, then the message length, then the message type and the
payload.</p></div>
<div class="paragraph"><p>The following reply types are implemented:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
COMMAND (0)
</dt>
<dd>
<p>
        Confirmation/Error code for the RUN_COMMAND message.
</p>
</dd>
<dt class="hdlist1">
WORKSPACES (1)
</dt>
<dd>
<p>
        Reply to the GET_WORKSPACES message.
</p>
</dd>
<dt class="hdlist1">
SUBSCRIBE (2)
</dt>
<dd>
<p>
        Confirmation/Error code for the SUBSCRIBE message.
</p>
</dd>
<dt class="hdlist1">
OUTPUTS (3)
</dt>
<dd>
<p>
        Reply to the GET_OUTPUTS message.
</p>
</dd>
<dt class="hdlist1">
TREE (4)
</dt>
<dd>
<p>
        Reply to the GET_TREE message.
</p>
</dd>
<dt class="hdlist1">
MARKS (5)
</dt>
<dd>
<p>
        Reply to the GET_MARKS message.
</p>
</dd>
<dt class="hdlist1">
BAR_CONFIG (6)
</dt>
<dd>
<p>
        Reply to the GET_BAR_CONFIG message.
</p>
</dd>
<dt class="hdlist1">
VERSION (7)
</dt>
<dd>
<p>
        Reply to the GET_VERSION message.
</p>
</dd>
<dt class="hdlist1">
BINDING_MODES (8)
</dt>
<dd>
<p>
        Reply to the GET_BINDING_MODES message.
</p>
</dd>
<dt class="hdlist1">
GET_CONFIG (9)
</dt>
<dd>
<p>
        Reply to the GET_CONFIG message.
</p>
</dd>
<dt class="hdlist1">
TICK (10)
</dt>
<dd>
<p>
        Reply to the SEND_TICK message.
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_command_reply">3.2. COMMAND reply</h3>
<div class="paragraph"><p>The reply consists of a list of serialized maps for each command that was
parsed. Each has the property <code>success (bool)</code> and may also include a
human-readable error message in the property <code>error (string)</code>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">When sending the <code>restart</code> command, you will get a singular reply once the
restart completed. All IPC connection states (e.g. subscriptions) will reset and
all but one socket will be closed. Libraries must be able to cope with this by
aligning their internal states. It is also recommended that libraries close
the last remaining socket(one which replied to <code>restart</code> command) to achieve
the full reset.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">It is easiest to always send the <code>restart</code> command alone: due to i3’s
state reset, the reply messages of preceding commands are lost, and following
commands will not be executed.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">When processing the <code>exit</code> command, i3 will immediately exit without
sending a reply. Expect the socket to be shut down.</td>
</tr></table>
</div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>[{ "success": true }]</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_workspaces_reply">3.3. WORKSPACES reply</h3>
<div class="paragraph"><p>The reply consists of a serialized list of workspaces. Each workspace has the
following properties:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
num (integer)
</dt>
<dd>
<p>
        The logical number of the workspace. Corresponds to the command
        to switch to this workspace. For named workspaces, this will be -1.
</p>
</dd>
<dt class="hdlist1">
name (string)
</dt>
<dd>
<p>
        The name of this workspace (by default num+1), as changed by the
        user. Encoded in UTF-8.
</p>
</dd>
<dt class="hdlist1">
visible (boolean)
</dt>
<dd>
<p>
        Whether this workspace is currently visible on an output (multiple
        workspaces can be visible at the same time).
</p>
</dd>
<dt class="hdlist1">
focused (boolean)
</dt>
<dd>
<p>
        Whether this workspace currently has the focus (only one workspace
        can have the focus at the same time).
</p>
</dd>
<dt class="hdlist1">
urgent (boolean)
</dt>
<dd>
<p>
        Whether a window on this workspace has the "urgent" flag set.
</p>
</dd>
<dt class="hdlist1">
rect (map)
</dt>
<dd>
<p>
        The rectangle of this workspace (equals the rect of the output it
        is on), consists of x, y, width, height.
</p>
</dd>
<dt class="hdlist1">
output (string)
</dt>
<dd>
<p>
        The video output this workspace is on (LVDS1, VGA1, …).
</p>
</dd>
</dl></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>[
 {
  "num": 0,
  "name": "1",
  "visible": true,
  "focused": true,
  "urgent": false,
  "rect": {
   "x": 0,
   "y": 0,
   "width": 1280,
   "height": 800
  },
  "output": "LVDS1"
 },
 {
  "num": 1,
  "name": "2",
  "visible": false,
  "focused": false,
  "urgent": false,
  "rect": {
   "x": 0,
   "y": 0,
   "width": 1280,
   "height": 800
  },
  "output": "LVDS1"
 }
]</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_subscribe_reply">3.4. SUBSCRIBE reply</h3>
<div class="paragraph"><p>The reply consists of a single serialized map. The only property is
<code>success (bool)</code>, indicating whether the subscription was successful (the
default) or whether a JSON parse error occurred.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{ "success": true }</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_outputs_reply">3.5. OUTPUTS reply</h3>
<div class="paragraph"><p>The reply consists of a serialized list of outputs. Each output has the
following properties:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
name (string)
</dt>
<dd>
<p>
        The name of this output (as seen in <code>xrandr(1)</code>). Encoded in UTF-8.
</p>
</dd>
<dt class="hdlist1">
active (boolean)
</dt>
<dd>
<p>
        Whether this output is currently active (has a valid mode).
</p>
</dd>
<dt class="hdlist1">
primary (boolean)
</dt>
<dd>
<p>
        Whether this output is currently the primary output.
</p>
</dd>
<dt class="hdlist1">
current_workspace (string)
</dt>
<dd>
<p>
        The name of the current workspace that is visible on this output. <code>null</code> if
        the output is not active.
</p>
</dd>
<dt class="hdlist1">
rect (map)
</dt>
<dd>
<p>
        The rectangle of this output (equals the rect of the output it
        is on), consists of x, y, width, height.
</p>
</dd>
</dl></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>[
 {
  "name": "LVDS1",
  "active": true,
  "current_workspace": "4",
  "rect": {
   "x": 0,
   "y": 0,
   "width": 1280,
   "height": 800
  }
 },
 {
  "name": "VGA1",
  "active": true,
  "current_workspace": "1",
  "rect": {
   "x": 1280,
   "y": 0,
   "width": 1280,
   "height": 1024
  }
 }
]</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_tree_reply">3.6. TREE reply</h3>
<div class="paragraph"><p>The reply consists of a serialized tree. Each node in the tree (representing
one container) has at least the properties listed below. While the nodes might
have more properties, please do not use any properties which are not documented
here. They are not yet finalized and will probably change!</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
id (integer)
</dt>
<dd>
<p>
        The internal ID (actually a C pointer value) of this container. Do not
        make any assumptions about it. You can use it to (re-)identify and
        address containers when talking to i3.
</p>
</dd>
<dt class="hdlist1">
name (string)
</dt>
<dd>
<p>
        The internal name of this container. For all containers which are part
        of the tree structure down to the workspace contents, this is set to a
        nice human-readable name of the container.
        For containers that have an X11 window, the content is the title
        (_NET_WM_NAME property) of that window.
        For all other containers, the content is not defined (yet).
</p>
</dd>
<dt class="hdlist1">
type (string)
</dt>
<dd>
<p>
        Type of this container. Can be one of "root", "output", "con",
        "floating_con", "workspace" or "dockarea".
</p>
</dd>
<dt class="hdlist1">
border (string)
</dt>
<dd>
<p>
        Can be either "normal", "none" or "pixel", depending on the
        container’s border style.
</p>
</dd>
<dt class="hdlist1">
current_border_width (integer)
</dt>
<dd>
<p>
        Number of pixels of the border width.
</p>
</dd>
<dt class="hdlist1">
layout (string)
</dt>
<dd>
<p>
        Can be either "splith", "splitv", "stacked", "tabbed", "dockarea" or
        "output".
        Other values might be possible in the future, should we add new
        layouts.
</p>
</dd>
<dt class="hdlist1">
orientation (string)
</dt>
<dd>
<p>
        Can be either "none" (for non-split containers), "horizontal" or
        "vertical".
        THIS FIELD IS OBSOLETE. It is still present, but your code should not
        use it. Instead, rely on the layout field.
</p>
</dd>
<dt class="hdlist1">
percent (float)
</dt>
<dd>
<p>
        The percentage which this container takes in its parent. A value of
        <code>null</code> means that the percent property does not make sense for this
        container, for example for the root container.
</p>
</dd>
<dt class="hdlist1">
rect (map)
</dt>
<dd>
<p>
        The absolute display coordinates for this container. Display
        coordinates means that when you have two 1600x1200 monitors on a single
        X11 Display (the standard way), the coordinates of the first window on
        the second monitor are <code>{ "x": 1600, "y": 0, "width": 1600, "height":
        1200 }</code>.
</p>
</dd>
<dt class="hdlist1">
window_rect (map)
</dt>
<dd>
<p>
        The coordinates of the <strong>actual client window</strong> inside its container.
        These coordinates are relative to the container and do not include the
        window decoration (which is actually rendered on the parent container).
        So, when using the <code>default</code> layout, you will have a 2 pixel border on
        each side, making the window_rect <code>{ "x": 2, "y": 0, "width": 632,
        "height": 366 }</code> (for example).
</p>
</dd>
<dt class="hdlist1">
deco_rect (map)
</dt>
<dd>
<p>
        The coordinates of the <strong>window decoration</strong> inside its container. These
        coordinates are relative to the container and do not include the actual
        client window.
</p>
</dd>
<dt class="hdlist1">
geometry (map)
</dt>
<dd>
<p>
        The original geometry the window specified when i3 mapped it. Used when
        switching a window to floating mode, for example.
</p>
</dd>
<dt class="hdlist1">
window (integer)
</dt>
<dd>
<p>
        The X11 window ID of the <strong>actual client window</strong> inside this container.
        This field is set to null for split containers or otherwise empty
        containers. This ID corresponds to what xwininfo(1) and other
        X11-related tools display (usually in hex).
</p>
</dd>
<dt class="hdlist1">
window_properties (map)
</dt>
<dd>
<p>
        X11 window properties title, instance, class, window_role and transient_for.
</p>
</dd>
<dt class="hdlist1">
urgent (bool)
</dt>
<dd>
<p>
        Whether this container (window, split container, floating container or
        workspace) has the urgency hint set, directly or indirectly. All parent
        containers up until the workspace container will be marked urgent if they
        have at least one urgent child.
</p>
</dd>
<dt class="hdlist1">
focused (bool)
</dt>
<dd>
<p>
        Whether this container is currently focused.
</p>
</dd>
<dt class="hdlist1">
focus (array of integer)
</dt>
<dd>
<p>
        List of child node IDs (see <code>nodes</code>, <code>floating_nodes</code> and <code>id</code>) in focus
        order. Traversing the tree by following the first entry in this array
        will result in eventually reaching the one node with <code>focused</code> set to
        true.
</p>
</dd>
<dt class="hdlist1">
nodes (array of node)
</dt>
<dd>
<p>
        The tiling (i.e. non-floating) child containers of this node.
</p>
</dd>
<dt class="hdlist1">
floating_nodes (array of node)
</dt>
<dd>
<p>
        The floating child containers of this node. Only non-empty on nodes with
        type <code>workspace</code>.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Please note that in the following example, I have left out some keys/values
which are not relevant for the type of the node. Otherwise, the example would
be by far too long (it already is quite long, despite showing only 1 window and
one dock window).</p></div>
<div class="paragraph"><p>It is useful to have an overview of the structure before taking a look at the
JSON dump:</p></div>
<div class="ulist"><ul>
<li>
<p>
root
</p>
<div class="ulist"><ul>
<li>
<p>
LVDS1
</p>
<div class="ulist"><ul>
<li>
<p>
topdock
</p>
</li>
<li>
<p>
content
</p>
<div class="ulist"><ul>
<li>
<p>
workspace 1
</p>
<div class="ulist"><ul>
<li>
<p>
window 1
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
bottomdock
</p>
<div class="ulist"><ul>
<li>
<p>
dock window 1
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
VGA1
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
 "id": 6875648,
 "name": "root",
 "rect": {
   "x": 0,
   "y": 0,
   "width": 1280,
   "height": 800
 },
 "nodes": [

   {
    "id": 6878320,
    "name": "LVDS1",
    "layout": "output",
    "rect": {
      "x": 0,
      "y": 0,
      "width": 1280,
      "height": 800
    },
    "nodes": [

      {
       "id": 6878784,
       "name": "topdock",
       "layout": "dockarea",
       "orientation": "vertical",
       "rect": {
         "x": 0,
         "y": 0,
         "width": 1280,
         "height": 0
       }
      },

      {
       "id": 6879344,
       "name": "content",
       "rect": {
         "x": 0,
         "y": 0,
         "width": 1280,
         "height": 782
       },
       "nodes": [

         {
          "id": 6880464,
          "name": "1",
          "orientation": "horizontal",
          "rect": {
            "x": 0,
            "y": 0,
            "width": 1280,
            "height": 782
          },
          "window_properties": {
            "class": "Evince",
            "instance": "evince",
            "title": "Properties",
            "transient_for": 52428808
          },
          "floating_nodes": [],
          "nodes": [

            {
             "id": 6929968,
             "name": "#aa0000",
             "border": "normal",
             "percent": 1,
             "rect": {
               "x": 0,
               "y": 18,
               "width": 1280,
               "height": 782
             }
            }

          ]
         }

       ]
      },

      {
       "id": 6880208,
       "name": "bottomdock",
       "layout": "dockarea",
       "orientation": "vertical",
       "rect": {
         "x": 0,
         "y": 782,
         "width": 1280,
         "height": 18
       },
       "nodes": [

         {
          "id": 6931312,
          "name": "#00aa00",
          "percent": 1,
          "rect": {
            "x": 0,
            "y": 782,
            "width": 1280,
            "height": 18
          }
         }

       ]
      }
    ]
   }
 ]
}</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_marks_reply">3.7. MARKS reply</h3>
<div class="paragraph"><p>The reply consists of a single array of strings for each container that has a
mark. A mark can only be set on one container, so the array is unique.
The order of that array is undefined.</p></div>
<div class="paragraph"><p>If no window has a mark the response will be the empty array [].</p></div>
</div>
<div class="sect2">
<h3 id="_bar_config_reply">3.8. BAR_CONFIG reply</h3>
<div class="paragraph"><p>This can be used by third-party workspace bars (especially i3bar, but others
are free to implement compatible alternatives) to get the <code>bar</code> block
configuration from i3.</p></div>
<div class="paragraph"><p>Depending on the input, the reply is either:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
empty input
</dt>
<dd>
<p>
        An array of configured bar IDs
</p>
</dd>
<dt class="hdlist1">
Bar ID
</dt>
<dd>
<p>
        A JSON map containing the configuration for the specified bar.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Each bar configuration has the following properties:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
id (string)
</dt>
<dd>
<p>
        The ID for this bar. Included in case you request multiple
        configurations and want to differentiate the different replies.
</p>
</dd>
<dt class="hdlist1">
mode (string)
</dt>
<dd>
<p>
        Either <code>dock</code> (the bar sets the dock window type) or <code>hide</code> (the bar
        does not show unless a specific key is pressed).
</p>
</dd>
<dt class="hdlist1">
position (string)
</dt>
<dd>
<p>
        Either <code>bottom</code> or <code>top</code> at the moment.
</p>
</dd>
<dt class="hdlist1">
status_command (string)
</dt>
<dd>
<p>
        Command which will be run to generate a statusline. Each line on stdout
        of this command will be displayed in the bar. At the moment, no
        formatting is supported.
</p>
</dd>
<dt class="hdlist1">
font (string)
</dt>
<dd>
<p>
        The font to use for text on the bar.
</p>
</dd>
<dt class="hdlist1">
workspace_buttons (boolean)
</dt>
<dd>
<p>
        Display workspace buttons or not? Defaults to true.
</p>
</dd>
<dt class="hdlist1">
binding_mode_indicator (boolean)
</dt>
<dd>
<p>
        Display the mode indicator or not? Defaults to true.
</p>
</dd>
<dt class="hdlist1">
verbose (boolean)
</dt>
<dd>
<p>
        Should the bar enable verbose output for debugging? Defaults to false.
</p>
</dd>
<dt class="hdlist1">
colors (map)
</dt>
<dd>
<p>
        Contains key/value pairs of colors. Each value is a color code in hex,
        formatted #rrggbb (like in HTML).
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The following colors can be configured at the moment:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
background
</dt>
<dd>
<p>
        Background color of the bar.
</p>
</dd>
<dt class="hdlist1">
statusline
</dt>
<dd>
<p>
        Text color to be used for the statusline.
</p>
</dd>
<dt class="hdlist1">
separator
</dt>
<dd>
<p>
        Text color to be used for the separator.
</p>
</dd>
<dt class="hdlist1">
focused_background
</dt>
<dd>
<p>
        Background color of the bar on the currently focused monitor output.
</p>
</dd>
<dt class="hdlist1">
focused_statusline
</dt>
<dd>
<p>
        Text color to be used for the statusline on the currently focused
        monitor output.
</p>
</dd>
<dt class="hdlist1">
focused_separator
</dt>
<dd>
<p>
        Text color to be used for the separator on the currently focused
        monitor output.
</p>
</dd>
<dt class="hdlist1">
focused_workspace_text/focused_workspace_bg/focused_workspace_border
</dt>
<dd>
<p>
        Text/background/border color for a workspace button when the workspace
        has focus.
</p>
</dd>
<dt class="hdlist1">
active_workspace_text/active_workspace_bg/active_workspace_border
</dt>
<dd>
<p>
        Text/background/border color for a workspace button when the workspace
        is active (visible) on some output, but the focus is on another one.
        You can only tell this apart from the focused workspace when you are
        using multiple monitors.
</p>
</dd>
<dt class="hdlist1">
inactive_workspace_text/inactive_workspace_bg/inactive_workspace_border
</dt>
<dd>
<p>
        Text/background/border color for a workspace button when the workspace
        does not have focus and is not active (visible) on any output. This
        will be the case for most workspaces.
</p>
</dd>
<dt class="hdlist1">
urgent_workspace_text/urgent_workspace_bg/urgent_workspace_border
</dt>
<dd>
<p>
        Text/background/border color for workspaces which contain at least one
        window with the urgency hint set.
</p>
</dd>
<dt class="hdlist1">
binding_mode_text/binding_mode_bg/binding_mode_border
</dt>
<dd>
<p>
        Text/background/border color for the binding mode indicator.
</p>
</dd>
</dl></div>
<div class="paragraph"><p><strong>Example of configured bars:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>["bar-bxuqzf"]</code></pre>
</div></div>
<div class="paragraph"><p><strong>Example of bar configuration:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
 "id": "bar-bxuqzf",
 "mode": "dock",
 "position": "bottom",
 "status_command": "i3status",
 "font": "-misc-fixed-medium-r-normal--13-120-75-75-C-70-iso10646-1",
 "workspace_buttons": true,
 "binding_mode_indicator": true,
 "verbose": false,
 "colors": {
   "background": "#c0c0c0",
   "statusline": "#00ff00",
   "focused_workspace_text": "#ffffff",
   "focused_workspace_bg": "#000000"
 }
}</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_version_reply">3.9. VERSION reply</h3>
<div class="paragraph"><p>The reply consists of a single JSON dictionary with the following keys:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
major (integer)
</dt>
<dd>
<p>
        The major version of i3, such as <code>4</code>.
</p>
</dd>
<dt class="hdlist1">
minor (integer)
</dt>
<dd>
<p>
        The minor version of i3, such as <code>2</code>. Changes in the IPC interface (new
        features) will only occur with new minor (or major) releases. However,
        bugfixes might be introduced in patch releases, too.
</p>
</dd>
<dt class="hdlist1">
patch (integer)
</dt>
<dd>
<p>
        The patch version of i3, such as <code>1</code> (when the complete version is
        <code>4.2.1</code>). For versions such as <code>4.2</code>, patch will be set to <code>0</code>.
</p>
</dd>
<dt class="hdlist1">
human_readable (string)
</dt>
<dd>
<p>
        A human-readable version of i3 containing the precise git version,
        build date and branch name. When you need to display the i3 version to
        your users, use the human-readable version whenever possible (since
        this is what <code>i3 --version</code> displays, too).
</p>
</dd>
<dt class="hdlist1">
loaded_config_file_name (string)
</dt>
<dd>
<p>
        The current config path.
</p>
</dd>
</dl></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
   "human_readable" : "4.2-169-gf80b877 (2012-08-05, branch \"next\")",
   "loaded_config_file_name" : "/home/hwangcc23/.i3/config",
   "minor" : 2,
   "patch" : 0,
   "major" : 4
}</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_binding_modes_reply">3.10. BINDING_MODES reply</h3>
<div class="paragraph"><p>The reply consists of an array of all currently configured binding modes.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>["default", "resize"]</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_config_reply">3.11. CONFIG reply</h3>
<div class="paragraph"><p>The config reply is a map which currently only contains the "config" member,
which is a string containing the config file as loaded by i3 most recently.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{ "config": "font pango:monospace 8\nbindsym Mod4+q exit\n" }</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_tick_reply">3.12. TICK reply</h3>
<div class="paragraph"><p>The reply is a map containing the "success" member. After the reply was
received, the tick event has been written to all IPC connections which subscribe
to tick events. UNIX sockets are usually buffered, but you can be certain that
once you receive the tick event you just triggered, you must have received all
events generated prior to the <code>SEND_TICK</code> message (happened-before relation).</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{ "success": true }</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_sync_reply">3.13. SYNC reply</h3>
<div class="paragraph"><p>The reply is a map containing the "success" member. After the reply was
received, the <a href="https://i3wm.org/docs/testsuite.html#i3_sync">i3 sync message</a> was
responded to.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{ "success": true }</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_events">4. Events</h2>
<div class="sectionbody">
<div class="paragraph" id="events"><p>To get informed when certain things happen in i3, clients can subscribe to
events. Events consist of a name (like "workspace") and an event reply type
(like I3_IPC_EVENT_WORKSPACE). Events sent by i3 follow a format similar to
replies but with the highest bit of the message type set to 1 to indicate an
event reply instead of a normal reply. Note that event types and reply types
do not follow the same enumeration scheme (e.g. event type 0 corresponds to the
workspace event however reply type 0 corresponds to the COMMAND reply).</p></div>
<div class="paragraph"><p>Caveat: As soon as you subscribe to an event, it is not guaranteed any longer
that the requests to i3 are processed in order. This means, the following
situation can happen: You send a GET_WORKSPACES request but you receive a
"workspace" event before receiving the reply to GET_WORKSPACES. If your
program does not want to cope which such kinds of race conditions (an
event based library may not have a problem here), I suggest you create a
separate connection to receive events.</p></div>
<div class="paragraph"><p>If an event message needs to be sent and the socket is not writeable (write
returns EAGAIN, happens when the socket doesn&#8217;t have enough buffer space for
writing new data) then i3 uses a queue system to store outgoing messages for
each client. This is combined with a timer: if the message queue for a client is
not empty and no data where successfully written in the past 10 seconds, the
connection is killed. Practically, this means that your client should try to
always read events from the socket to avoid having its connection closed.</p></div>
<div class="sect2">
<h3 id="_subscribing_to_events">4.1. Subscribing to events</h3>
<div class="paragraph"><p>By sending a message of type SUBSCRIBE with a JSON-encoded array as payload
you can register to an event.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>type: SUBSCRIBE
payload: [ "workspace", "output" ]</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_available_events">4.2. Available events</h3>
<div class="paragraph"><p>The numbers in parenthesis is the event type (keep in mind that you need to
strip the highest bit first).</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
workspace (0)
</dt>
<dd>
<p>
        Sent when the user switches to a different workspace, when a new
        workspace is initialized or when a workspace is removed (because the
        last client vanished).
</p>
</dd>
<dt class="hdlist1">
output (1)
</dt>
<dd>
<p>
        Sent when RandR issues a change notification (of either screens,
        outputs, CRTCs or output properties).
</p>
</dd>
<dt class="hdlist1">
mode (2)
</dt>
<dd>
<p>
        Sent whenever i3 changes its binding mode.
</p>
</dd>
<dt class="hdlist1">
window (3)
</dt>
<dd>
<p>
        Sent when a client&#8217;s window is successfully reparented (that is when i3
        has finished fitting it into a container), when a window received input
        focus or when certain properties of the window have changed.
</p>
</dd>
<dt class="hdlist1">
barconfig_update (4)
</dt>
<dd>
<p>
    Sent when the hidden_state or mode field in the barconfig of any bar
    instance was updated and when the config is reloaded.
</p>
</dd>
<dt class="hdlist1">
binding (5)
</dt>
<dd>
<p>
        Sent when a configured command binding is triggered with the keyboard or
        mouse
</p>
</dd>
<dt class="hdlist1">
shutdown (6)
</dt>
<dd>
<p>
        Sent when the ipc shuts down because of a restart or exit by user command
</p>
</dd>
<dt class="hdlist1">
tick (7)
</dt>
<dd>
<p>
        Sent when the ipc client subscribes to the tick event (with <code>"first":
        true</code>) or when any ipc client sends a SEND_TICK message (with <code>"first":
        false</code>).
</p>
</dd>
</dl></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code># the appropriate 4 bytes read from the socket are stored in $input

# unpack a 32-bit unsigned integer
my $message_type = unpack("L", $input);

# check if the highest bit is 1
my $is_event = (($message_type &gt;&gt; 31) == 1);

# use the other bits
my $event_type = ($message_type &amp; 0x7F);

if ($is_event) {
  say "Received event of type $event_type";
}</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_workspace_event">4.3. workspace event</h3>
<div class="paragraph"><p>This event consists of a single serialized map containing a property
<code>change (string)</code> which indicates the type of the change ("focus", "init",
"empty", "urgent", "reload", "rename", "restored", "move"). A
<code>current (object)</code> property will be present with the affected workspace
whenever the type of event affects a workspace (otherwise, it will be <code>null</code>).</p></div>
<div class="paragraph"><p>When the change is "focus", an <code>old (object)</code> property will be present with the
previous workspace.  When the first switch occurs (when i3 focuses the
workspace visible at the beginning) there is no previous workspace, and the
<code>old</code> property will be set to <code>null</code>.  Also note that if the previous is empty
it will get destroyed when switching, but will still be present in the "old"
property.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
 "change": "focus",
 "current": {
  "id": 28489712,
  "type": "workspace",
  ...
 }
 "old": {
  "id": 28489715,
  "type": "workspace",
  ...
 }
}</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_output_event">4.4. output event</h3>
<div class="paragraph"><p>This event consists of a single serialized map containing a property
<code>change (string)</code> which indicates the type of the change (currently only
"unspecified").</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{ "change": "unspecified" }</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_mode_event">4.5. mode event</h3>
<div class="paragraph"><p>This event consists of a single serialized map containing a property
<code>change (string)</code> which holds the name of current mode in use. The name
is the same as specified in config when creating a mode. The default
mode is simply named default. It contains a second property, <code>pango_markup</code>, which
defines whether pango markup shall be used for displaying this mode.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
  "change": "default",
  "pango_markup": true
}</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_window_event">4.6. window event</h3>
<div class="paragraph"><p>This event consists of a single serialized map containing a property
<code>change (string)</code> which indicates the type of the change</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>new</code> – the window has become managed by i3
</p>
</li>
<li>
<p>
<code>close</code> – the window has closed
</p>
</li>
<li>
<p>
<code>focus</code> – the window has received input focus
</p>
</li>
<li>
<p>
<code>title</code> – the window&#8217;s title has changed
</p>
</li>
<li>
<p>
<code>fullscreen_mode</code> – the window has entered or exited fullscreen mode
</p>
</li>
<li>
<p>
<code>move</code> – the window has changed its position in the tree
</p>
</li>
<li>
<p>
<code>floating</code> – the window has transitioned to or from floating
</p>
</li>
<li>
<p>
<code>urgent</code> – the window has become urgent or lost its urgent status
</p>
</li>
<li>
<p>
<code>mark</code> – a mark has been added to or removed from the window
</p>
</li>
</ul></div>
<div class="paragraph"><p>Additionally a <code>container (object)</code> field will be present, which consists
of the window&#8217;s parent container. Be aware that for the "new" event, the
container will hold the initial name of the newly reparented window (e.g.
if you run urxvt with a shell that changes the title, you will still at
this point get the window title as "urxvt").</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
 "change": "new",
 "container": {
  "id": 35569536,
  "type": "con",
  ...
 }
}</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_barconfig_update_event">4.7. barconfig_update event</h3>
<div class="paragraph"><p>This event consists of a single serialized map reporting on options from the
barconfig of the specified bar_id that were updated in i3. This event is the
same as a <code>GET_BAR_CONFIG</code> reply for the bar with the given id.</p></div>
</div>
<div class="sect2">
<h3 id="_binding_event">4.8. binding event</h3>
<div class="paragraph"><p>This event consists of a single serialized map reporting on the details of a
binding that ran a command because of user input. The <code>change (string)</code> field
indicates what sort of binding event was triggered (right now it will always be
<code>"run"</code> but may be expanded in the future).</p></div>
<div class="paragraph"><p>The <code>binding (object)</code> field contains details about the binding that was run:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
command (string)
</dt>
<dd>
<p>
        The i3 command that is configured to run for this binding.
</p>
</dd>
<dt class="hdlist1">
event_state_mask (array of strings)
</dt>
<dd>
<p>
        The group and modifier keys that were configured with this binding.
</p>
</dd>
<dt class="hdlist1">
input_code (integer)
</dt>
<dd>
<p>
        If the binding was configured with <code>bindcode</code>, this will be the key code
        that was given for the binding. If the binding is a mouse binding, it will be
        the number of the mouse button that was pressed. Otherwise it will be 0.
</p>
</dd>
<dt class="hdlist1">
symbol (string or null)
</dt>
<dd>
<p>
        If this is a keyboard binding that was configured with <code>bindsym</code>, this
        field will contain the given symbol. Otherwise it will be <code>null</code>.
</p>
</dd>
<dt class="hdlist1">
input_type (string)
</dt>
<dd>
<p>
        This will be <code>"keyboard"</code> or <code>"mouse"</code> depending on whether or not this was
        a keyboard or a mouse binding.
</p>
</dd>
</dl></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
 "change": "run",
 "binding": {
  "command": "nop",
  "event_state_mask": [
    "shift",
    "ctrl"
  ],
  "input_code": 0,
  "symbol": "t",
  "input_type": "keyboard"
 }
}</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_shutdown_event">4.9. shutdown event</h3>
<div class="paragraph"><p>This event is triggered when the connection to the ipc is about to shutdown
because of a user action such as a <code>restart</code> or <code>exit</code> command. The <code>change
(string)</code> field indicates why the ipc is shutting down. It can be either
<code>"restart"</code> or <code>"exit"</code>.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
 "change": "restart"
}</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_tick_event">4.10. tick event</h3>
<div class="paragraph"><p>This event is triggered by a subscription to tick events or by a <code>SEND_TICK</code>
message.</p></div>
<div class="paragraph"><p><strong>Example (upon subscription):</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
 "first": true,
 "payload": ""
}</code></pre>
</div></div>
<div class="paragraph"><p><strong>Example (upon <code>SEND_TICK</code> with a payload of <code>arbitrary string</code>):</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><code>{
 "first": false,
 "payload": "arbitrary string"
}</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also_existing_libraries">5. See also (existing libraries)</h2>
<div class="sectionbody">
<div class="paragraph" id="libraries"><p>For some languages, libraries are available (so you don’t have to implement
all this on your own). This list names some (if you wrote one, please let me
know):</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
C
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
i3 includes a headerfile <code>i3/ipc.h</code> which provides you all constants.
</p>
</li>
<li>
<p>
<a href="https://github.com/acrisci/i3ipc-glib">https://github.com/acrisci/i3ipc-glib</a>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
C++
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/Iskustvo/i3-ipcpp">i3-ipc++</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/drmgc/i3ipcpp">https://github.com/drmgc/i3ipcpp</a>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
Go
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/mdirkse/i3ipc-go">https://github.com/mdirkse/i3ipc-go</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/i3/go-i3">https://github.com/i3/go-i3</a>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
JavaScript
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/acrisci/i3ipc-gjs">https://github.com/acrisci/i3ipc-gjs</a>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
Lua
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/acrisci/i3ipc-lua">https://github.com/acrisci/i3ipc-lua</a>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
Perl
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
<a href="https://metacpan.org/module/AnyEvent::I3">https://metacpan.org/module/AnyEvent::I3</a>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
Python
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/acrisci/i3ipc-python">https://github.com/acrisci/i3ipc-python</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/whitelynx/i3ipc">https://github.com/whitelynx/i3ipc</a> (not maintained)
</p>
</li>
<li>
<p>
<a href="https://github.com/ziberna/i3-py">https://github.com/ziberna/i3-py</a> (not maintained)
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
Ruby
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/veelenga/i3ipc-ruby">https://github.com/veelenga/i3ipc-ruby</a>
</p>
</li>
<li>
<p>
<a href="https://github.com/badboy/i3-ipc">https://github.com/badboy/i3-ipc</a> (not maintained)
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
Rust
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/tmerr/i3ipc-rs">https://github.com/tmerr/i3ipc-rs</a>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
OCaml
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/Armael/ocaml-i3ipc">https://github.com/Armael/ocaml-i3ipc</a>
</p>
</li>
</ul></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix_a_detecting_byte_order_in_memory_safe_languages">6. Appendix A: Detecting byte order in memory-safe languages</h2>
<div class="sectionbody">
<div class="paragraph"><p>Some programming languages such as Go don’t offer a way to serialize data in the
native byte order of the machine they’re running on without resorting to tricks
involving the <code>unsafe</code> package.</p></div>
<div class="paragraph"><p>The following technique can be used (and will not be broken by changes to i3) to
detect the byte order i3 is using:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
The byte order dependent fields of an IPC message are message type and
   payload length.
</p>
<div class="ulist"><ul>
<li>
<p>
The message type <code>RUN_COMMAND</code> (0) is the same in big and little endian, so
     we can use it in either byte order to elicit a reply from i3.
</p>
</li>
<li>
<p>
The payload length 65536 + 256 (<code>0x00 01 01 00</code>) is the same in big and
     little endian, and also small enough to not worry about memory allocations
     of that size. We must use payloads of length 65536 + 256 in every message
     we send, so that i3 will be able to read the entire message regardless of
     the byte order it uses.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Send a big endian encoded message of type <code>SUBSCRIBE</code> (2) with payload <code>[]</code>
   followed by 65536 + 256 - 2 <code>SPACE</code> (ASCII 0x20) bytes.
</p>
<div class="ulist"><ul>
<li>
<p>
If i3 is running in big endian, this message is treated as a noop,
     resulting in a <code>SUBSCRIBE</code> reply with payload <code>{"success":true}</code>
     <span class="footnote"><br />[A small payload is important: that way, we circumvent dealing
     with UNIX domain socket buffer sizes, whose size depends on the
     implementation/operating system. Exhausting such a buffer results in an i3
     deadlock unless you concurrently read and write, which — depending on the
     programming language — makes the technique much more complicated.]<br /></span>.
</p>
</li>
<li>
<p>
If i3 is running in little endian, this message is read in its entirety due
     to the byte order independent payload length, then
     <a href="https://github.com/i3/i3/blob/d726d09d496577d1c337a4b97486f2c9fbc914f1/src/ipc.c#L1188">silently
     discarded</a> due to the unknown message type.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Send a byte order independent message, i.e. type <code>RUN_COMMAND</code> (0) with
   payload <code>nop byte order detection. padding:</code>, padded to 65536 + 256 bytes
   with <code>a</code> (ASCII 0x61) bytes. i3 will reply to this message with a reply of
   type <code>COMMAND</code> (0).
</p>
<div class="ulist"><ul>
<li>
<p>
The human-readable prefix is in there to not confuse readers of the i3 log.
</p>
</li>
<li>
<p>
This messages serves as a synchronization primitive so that we know whether
     i3 discarded the <code>SUBSCRIBE</code> message or didn’t answer it yet.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Receive a message header from i3, decoding the message type as big endian.
</p>
<div class="ulist"><ul>
<li>
<p>
If the message’s reply type is <code>COMMAND</code> (0), i3 is running in little
     endian (because the <code>SUBSCRIBE</code> message was discarded). Decode the message
     payload length as little endian, receive the message payload.
</p>
</li>
<li>
<p>
If the message’s reply type is anything else, i3 is running in big endian
     (because our big endian encoded <code>SUBSCRIBE</code> message was answered). Decode
     the message payload length in big endian, receive the message
     payload. Then, receive the pending <code>COMMAND</code> message reply in big endian.
</p>
</li>
</ul></div>
</li>
<li>
<p>
From here on out, send/receive all messages using the detected byte order.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Find an example implementation of this technique in
<a href="https://github.com/i3/go-i3/blob/master/byteorder.go">https://github.com/i3/go-i3/blob/master/byteorder.go</a></p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2019-08-04 09:40:48 CEST
</div>
</div>
</body>
</html>
